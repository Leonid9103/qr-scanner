<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
        }
        
        /* Главный контейнер на весь экран */
        #reader { 
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw !important; 
            height: 100vh !important;
        }

        /* Заставляем само ВИДЕО игнорировать свои пропорции и заливать экран */
        #reader video { 
            width: 100vw !important; 
            height: 100vh !important; 
            object-fit: cover !important; 
        }

        /* Окошко сканера (canvas поверх видео) */
        #reader canvas {
            width: 100vw !important;
            height: 100vh !important;
            object-fit: cover !important;
        }

        /* Убираем все интерфейсные надписи библиотеки */
        #reader__header, #reader__dashboard, span { display: none !important; }
    </style>
</head>
<body>
    <div id="reader"></div>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // Настройка размера квадрата: 250px или 70% ширины
        const boxSize = Math.min(window.innerWidth * 0.7, 250);

        const html5QrCode = new Html5Qrcode("reader");
        
        html5QrCode.start(
            { facingMode: "environment" }, 
            { 
                fps: 20, // Больше кадров для скорости
                qrbox: { width: boxSize, height: boxSize },
                // Не ограничиваем aspectRatio здесь, даем CSS сделать object-fit: cover
            },
            (decodedText) => {
                tg.sendData(decodedText);
                tg.close();
            }
        ).catch(err => {
            console.error(err);
        });
    </script>
</body>
</html>